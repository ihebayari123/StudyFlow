{% extends 'base.html.twig' %}

{% block title %}Accueil - StudyFlow{% endblock %}

{% block body %}
<!-- ======= Header ======= -->
<header class="header-area header-sticky">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <nav class="main-nav">
          <!-- Logo -->
          <a href="{{ path('app_home') }}" class="logo">
            <h1 class="logo-text">StudyFlow</h1>
          </a>

          <!-- Menu -->
          <ul class="nav">
            <li class="scroll-to-section"><a href="#top" class="active">Home</a></li>
            <li class="scroll-to-section"><a href="#services">Services</a></li>
            <li class="scroll-to-section"><a href="#courses">Courses</a></li>
            <li class="scroll-to-section"><a href="#team">Team</a></li>
            <li class="scroll-to-section"><a href="#events">Events</a></li>
            <li class="scroll-to-section"><a href="#contact">Register Now!</a></li>
          </ul>

          <!-- Mobile Menu -->
          <a class="menu-trigger"><span>Menu</span></a>
        </nav>
      </div>
    </div>
  </div>
</header>

<!-- ======= Events Section ======= -->
<div class="section events" id="events" style="background: #f8f9fa; padding-top:0;">
  <div class="container">
    <div class="row mb-4">
      <div class="col-lg-12 text-center">
        <div class="section-heading">
          <h6 class="text-uppercase text-secondary fw-bold" style="letter-spacing:2px;">Schedule</h6>
          <h2 class="display-5 fw-bold" style="font-family: 'Poppins', sans-serif; letter-spacing:1px;">Upcoming Events</h2>
        </div>
      </div>
    </div>

    <div class="row" id="events-container">
      {% if events is empty %}
        <div class="col-12 text-center mt-4">
          <div class="alert alert-secondary">Aucun événement disponible.</div>
        </div>
      {% else %}
        {% for event in events %}
          <div class="col-lg-4 col-md-6 mb-4 event-item">
            <div class="card event-card shadow-sm border-0 position-relative">
              {% if event.image %}
                <img src="{{ asset('uploads/' ~ event.image) }}" class="card-img-top" alt="{{ event.titre }}">
              {% else %}
                <div class="bg-light d-flex align-items-center justify-content-center" style="height:200px;">
                  <span class="text-muted">Aucune image</span>
                </div>
              {% endif %}

              <div class="card-body">
                <span class="badge bg-primary mb-2">{{ event.type }}</span>
                <h5 class="card-title fw-bold">{{ event.titre }}</h5>
                <p class="card-text text-muted mb-1"><i class="bi bi-calendar-event"></i> {{ event.dateCreation ? event.dateCreation|date('d M Y') : '' }}</p>
                <p class="card-text">{{ event.description|length > 300 ? event.description|slice(0,300) ~ '...' : event.description }}</p>

                <p class="mb-2">
                  <strong>Sponsors:</strong>
                  {% if event.getSponsors() is not empty %}
                    {% for sponsor in event.getSponsors() %}
                      <span class="badge bg-info text-dark">{{ sponsor.nomSponsor }}</span>
                    {% endfor %}
                  {% else %}
                    Aucun sponsor
                  {% endif %}
                </p>

                <p class="countdown" data-date="{{ event.dateCreation ? event.dateCreation|date('Y-m-d H:i:s') : '' }}"></p>

                <span class="heart-icon" data-event-id="{{ event.id }}">
                  <i class="bi bi-heart" style="font-size:1.5rem; cursor:pointer;"></i>
                </span>
              </div>
            </div>
          </div>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</div>

<!-- ======= Styles ======= -->
<style>
/* Box sizing global */
* { box-sizing: border-box; }

/* Supprimer l’espace blanc au top */
html, body { margin:0; padding:0; height:100%; background-color:#f8f9fa; }

/* Navbar */
.header-area {
    position: sticky;
    top: 0;
    z-index: 999;
    background-color: #8a2be2; /* Navbar couleur fixe au départ */
    transition: background-color 0.3s, color 0.3s;
    padding:15px 0;
}

.header-area.scrolled {
    background-color:#5a189a; /* Navbar couleur foncée au scroll */
}

.header-area .container {
    padding-left: 0;
    padding-right: 0;
}

.header-area .nav a { color:white; transition: color 0.3s;}
.header-area.scrolled .nav a { color:#fff; }
.header-area .logo-text { color:#fff; transition: color 0.3s;}
.header-area.scrolled .logo-text { color:#ffd700; }

/* Events */
.event-card { border-radius: 15px; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s;}
.event-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.15); }
.event-card .card-title { font-family: 'Poppins', sans-serif; color: #333;}
.event-card .card-text { font-size:0.95rem;}
.heart-icon i { color:#ccc; transition: color 0.3s, transform 0.3s;}
.heart-icon.liked i { color:#8a2be2; transform: scale(1.2);}
.countdown { font-weight:bold; color:#8a2be2; margin-top:5px; font-family:'Poppins', sans-serif;}
</style>

<!-- ======= Scripts ======= -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Navbar scroll
    const header = document.querySelector('.header-area');
    window.addEventListener('scroll', function() {
        header.classList.toggle('scrolled', window.scrollY > 50);
    });

    // Coeurs dynamiques
    const hearts = document.querySelectorAll('.heart-icon');
    hearts.forEach(heart => {
        const id = heart.dataset.eventId;
        if(localStorage.getItem('heart_' + id) === 'liked') heart.classList.add('liked');
        heart.addEventListener('click', function(){
            heart.classList.toggle('liked');
            if(heart.classList.contains('liked')) localStorage.setItem('heart_' + id,'liked');
            else localStorage.removeItem('heart_' + id);
        });
    });

    // Compteur à rebours
    const countdowns = document.querySelectorAll('.countdown');
    function updateCountdown(){
        const now = new Date().getTime();
        countdowns.forEach(cd=>{
            const dateStr = cd.dataset.date;
            if(!dateStr) return;
            const eventTime = new Date(dateStr).getTime();
            const diff = eventTime - now;
            if(diff>0){
                const d=Math.floor(diff/(1000*60*60*24));
                const h=Math.floor((diff%(1000*60*60*24))/(1000*60*60));
                const m=Math.floor((diff%(1000*60*60))/(1000*60));
                const s=Math.floor((diff%60000)/1000);
                cd.textContent = `Starts in ${d}d ${h}h ${m}m ${s}s`;
            } else cd.textContent='Event started';
        });
    }
    setInterval(updateCountdown,1000);
    updateCountdown();
});
</script>
{% endblock %}
