{% extends 'base.html.twig' %}

{% block title %}Liste des Quiz - Plateforme √âducative{% endblock %}

{% block body %}
<!-- ======= Header ======= -->
{% block header %}
{% include 'home/navbar.html.twig' %}
{% endblock %}

<style>
/* Reset */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Body */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding-top: 140px;
}

/* Header / Navbar */
.header-area {
    background: rgba(0, 0, 0, 0.3) !important;
    backdrop-filter: blur(12px);
    height: 90px;
    box-shadow: 0 6px 25px rgba(0,0,0,0.35);
}

.main-nav .logo h1 {
    color: #ffffff;
    font-size: 28px;
    font-weight: 800;
}

.main-nav .nav li a {
    color: rgba(255,255,255,0.9);
    font-size: 15px;
    font-weight: 500;
    transition: color 0.3s ease;
}

.main-nav .nav li a:hover,
.main-nav .nav li a.active {
    color: #ffd166;
}

/* Container */
.container {
    max-width: 1300px;
    margin: auto;
    padding: 0 20px;
}

/* Page Header */
.header {
    text-align: center;
    margin-bottom: 40px;
}

.header h1 {
    font-size: 3rem;
    font-weight: 800;
    color: #ffffff;
    text-shadow: 2px 2px 6px rgba(0,0,0,0.25);
}

.header p {
    font-size: 1.2rem;
    color: rgba(255,255,255,0.85);
    margin-top: 10px;
}

/* Stats Cards */
.stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.stat-card {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    border: 1px solid rgba(255,255,255,0.2);
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
    background: rgba(255,255,255,0.25);
}

.stat-icon {
    font-size: 2rem;
    margin-bottom: 10px;
}

.stat-value {
    font-size: 2rem;
    font-weight: 800;
    color: white;
    line-height: 1.2;
}

.stat-label {
    color: rgba(255,255,255,0.9);
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Search and Filter Bar */
.search-filter-bar {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    border-radius: 50px;
    padding: 10px;
    margin-bottom: 40px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    border: 1px solid rgba(255,255,255,0.2);
}

.search-form {
    flex: 2;
    min-width: 250px;
    display: flex;
    gap: 8px;
}

.search-form input {
    flex: 1;
    padding: 12px 20px;
    border-radius: 30px;
    border: 2px solid rgba(255,255,255,0.3);
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    color: white;
    font-size: 0.95rem;
    transition: all 0.3s ease;
}

.search-form input::placeholder {
    color: rgba(255,255,255,0.7);
}

.search-form input:focus {
    outline: none;
    background: white;
    color: #333;
    border-color: white;
}

.search-form button {
    padding: 12px 24px;
    border-radius: 30px;
    border: none;
    background: white;
    color: #667eea;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.search-form button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255,255,255,0.35);
}

/* Sort Dropdown */
.sort-wrapper {
    flex: 1;
    min-width: 180px;
}

.sort-select {
    width: 100%;
    padding: 12px 20px;
    border-radius: 30px;
    border: 2px solid rgba(255,255,255,0.3);
    background: rgba(255,255,255,0.2);
    color: white;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 15px center;
}

.sort-select option {
    background: #667eea;
    color: white;
}

.sort-select:focus {
    outline: none;
    background: white;
    color: #333;
    border-color: white;
}

/* View Toggle */
.view-toggle {
    display: flex;
    gap: 5px;
    background: rgba(255,255,255,0.2);
    padding: 5px;
    border-radius: 30px;
}

.view-btn {
    padding: 8px 16px;
    border: none;
    background: transparent;
    color: rgba(255,255,255,0.7);
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.view-btn.active {
    background: white;
    color: #667eea;
    font-weight: 600;
}

/* Quiz Grid */
.quiz-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
}

/* Quiz Card */
.quiz-card {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 15px 40px rgba(0,0,0,0.25);
    transition: all 0.35s ease;
    display: flex;
    flex-direction: column;
    position: relative;
}

.quiz-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 25px 60px rgba(0,0,0,0.35);
}

/* Quiz Header */
.quiz-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px;
    color: white;
    position: relative;
}

.quiz-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(255,255,255,0.2);
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    backdrop-filter: blur(5px);
}

.quiz-header h2 {
    font-size: 1.4rem;
    font-weight: 700;
    margin-bottom: 5px;
    padding-right: 60px;
}

.quiz-meta {
    display: flex;
    gap: 15px;
    font-size: 0.85rem;
    opacity: 0.9;
}

/* Quiz Body */
.quiz-body {
    padding: 20px;
    flex: 1;
}

.quiz-info {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

.info-item {
    text-align: center;
}

.info-label {
    font-size: 0.75rem;
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.info-value {
    font-size: 1.1rem;
    font-weight: 700;
    color: #1e293b;
}

.quiz-course {
    background: #f1f5f9;
    padding: 10px;
    border-radius: 10px;
    text-align: center;
    color: #475569;
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 15px;
}

.quiz-description {
    color: #64748b;
    font-size: 0.9rem;
    line-height: 1.5;
    margin-bottom: 20px;
}

/* Actions */
.actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 15px;
}

.actions a {
    text-decoration: none;
    padding: 12px;
    border-radius: 12px;
    font-size: 0.9rem;
    font-weight: 600;
    text-align: center;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

/* Play Button */
.actions .play-quiz {
    background: linear-gradient(135deg, #6366f1, #4f46e5);
    color: white;
    grid-column: span 2;
}

.actions .play-quiz:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(99,102,241,0.5);
}

/* Edit Button */
.actions .edit {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: white;
}

.actions .edit:hover {
    box-shadow: 0 8px 20px rgba(34,197,94,0.5);
}

/* Delete Button */
.actions .delete {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
}

.actions .delete:hover {
    box-shadow: 0 8px 20px rgba(239,68,68,0.5);
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    border-radius: 30px;
    color: white;
}

.empty-state-icon {
    font-size: 4rem;
    margin-bottom: 20px;
}

.empty-state h3 {
    font-size: 1.8rem;
    margin-bottom: 10px;
}

.empty-state p {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-bottom: 30px;
}

.empty-state .btn-create {
    display: inline-block;
    padding: 15px 40px;
    background: white;
    color: #667eea;
    text-decoration: none;
    border-radius: 30px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.empty-state .btn-create:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(255,255,255,0.3);
}

/* Pagination */
.pagination {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 40px;
}

.pagination a,
.pagination span {
    padding: 10px 18px;
    border-radius: 12px;
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    color: white;
    text-decoration: none;
    transition: all 0.3s ease;
    border: 1px solid rgba(255,255,255,0.2);
}

.pagination a:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-2px);
}

.pagination .current {
    background: white;
    color: #667eea;
    font-weight: 600;
}

/* Responsive */
@media (max-width: 768px) {
    .header h1 {
        font-size: 2.2rem;
    }
    
    .search-filter-bar {
        flex-direction: column;
        border-radius: 20px;
    }
    
    .search-form {
        width: 100%;
    }
    
    .sort-wrapper {
        width: 100%;
    }
    
    .view-toggle {
        width: 100%;
        justify-content: center;
    }
    
    .stats-container {
        grid-template-columns: 1fr;
    }
}
</style>

<div class="container">
    {# Statistiques #}
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-icon">üìö</div>
            <div class="stat-value">{{ listQuiz|length }}</div>
            <div class="stat-label">Quiz disponibles</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚è±Ô∏è</div>
            <div class="stat-value">{{ listQuiz|reduce((carry, quiz) => carry + quiz.duree, 0) }}</div>
            <div class="stat-label">Minutes totales</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <div class="stat-value">{{ listQuiz|reduce((carry, quiz) => carry + (quiz.questions is defined ? quiz.questions|length : 0), 0) }}</div>
            <div class="stat-label">Questions totales</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üéØ</div>
            <div class="stat-value">{{ listQuiz|reduce((carry, quiz) => carry + (quiz.tentatives is defined ? quiz.tentatives|length : 0), 0) }}</div>
            <div class="stat-label">Tentatives</div>
        </div>
    </div>

    {# Barre de recherche et filtres #}
    <div class="search-filter-bar">
        <form method="get" class="search-form">
            <input
                type="text"
                name="q"
                placeholder="Rechercher un quiz par titre..."
                value="{{ app.request.get('q') }}"
            >
            <button type="submit">üîç Rechercher</button>
        </form>
        
        <div class="sort-wrapper">
            <select name="sort" class="sort-select" onchange="this.form.submit()">
                <option value="date_desc" {{ app.request.get('sort') == 'date_desc' ? 'selected' : '' }}>üìÖ Plus r√©cents</option>
                <option value="date_asc" {{ app.request.get('sort') == 'date_asc' ? 'selected' : '' }}>üìÖ Plus anciens</option>
                <option value="title_asc" {{ app.request.get('sort') == 'title_asc' ? 'selected' : '' }}>üî§ Titre (A-Z)</option>
                <option value="title_desc" {{ app.request.get('sort') == 'title_desc' ? 'selected' : '' }}>üî§ Titre (Z-A)</option>
                <option value="duration_asc" {{ app.request.get('sort') == 'duration_asc' ? 'selected' : '' }}>‚è±Ô∏è Dur√©e (croissante)</option>
                <option value="duration_desc" {{ app.request.get('sort') == 'duration_desc' ? 'selected' : '' }}>‚è±Ô∏è Dur√©e (d√©croissante)</option>
            </select>
        </div>
        
        <div class="view-toggle">
            <button class="view-btn active" onclick="changeView('grid')">üì± Grille</button>
            <button class="view-btn" onclick="changeView('list')">üìã Liste</button>
        </div>
    </div>

    {# Grille des quiz #}
    <div class="quiz-grid" id="quizGrid">
        {% for quiz in listQuiz %}
            <div class="quiz-card">
                <div class="quiz-header">
                    <span class="quiz-badge">#{{ loop.index }}</span>
                    <h2>{{ quiz.titre }}</h2>
                    <div class="quiz-meta">
                        <span>üìÖ {{ quiz.dateCreation ? quiz.dateCreation|date('d/m/Y') : '‚Äî' }}</span>
                        
                    </div>
                </div>
                
                <div class="quiz-body">
                    <div class="quiz-info">
                        <div class="info-item">
                            <div class="info-label">Dur√©e</div>
                            <div class="info-value">{{ quiz.duree }} min</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Questions</div>
                            <div class="info-value">{{ quiz.questions is defined ? quiz.questions|length : 0 }}</div>
                        </div>
                    </div>
                    
                    <div class="quiz-course">
                        üìö {{ quiz.course ? quiz.course.titre : 'Cours non assign√©' }}
                    </div>
                    
                    <div class="quiz-description">
                        {% if quiz.description is defined %}
                            {{ quiz.description|slice(0, 80) ~ (quiz.description|length > 80 ? '...' : '') }}
                        {% else %}
                            Pr√™t √† tester vos connaissances sur ce sujet passionnant.
                        {% endif %}
                    </div>
                    
                    <div class="actions">
                        <a href="{{ path('app_quiz_play', {id: quiz.id}) }}" class="play-quiz">
                            ‚ñ∂Ô∏è Commencer le Quiz
                        </a>
                        
                    </div>
                </div>
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üì≠</div>
                <h3>Aucun quiz trouv√©</h3>
                <p>Il n'y a pas encore de quiz disponibles. Soyez le premier √† en cr√©er un !</p>
                <a href="{{ path('quiz_new') }}" class="btn-create">‚ûï Cr√©er un quiz</a>
            </div>
        {% endfor %}
    </div>

    {# Pagination #}
    {% if listQuiz|length > 9 %}
    <div class="pagination">
        <a href="#" class="prev">‚Üê Pr√©c√©dent</a>
        <span class="current">1</span>
        <a href="#">2</a>
        <a href="#">3</a>
        <a href="#">4</a>
        <span>...</span>
        <a href="#">10</a>
        <a href="#" class="next">Suivant ‚Üí</a>
    </div>
    {% endif %}
</div>

<script>
// Fonction pour changer l'affichage (grille/liste)
function changeView(view) {
    const grid = document.getElementById('quizGrid');
    const buttons = document.querySelectorAll('.view-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    if (view === 'list') {
        grid.style.gridTemplateColumns = '1fr';
        document.querySelectorAll('.quiz-card').forEach(card => {
            card.style.display = 'grid';
            card.style.gridTemplateColumns = '200px 1fr';
        });
    } else {
        grid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(320px, 1fr))';
        document.querySelectorAll('.quiz-card').forEach(card => {
            card.style.display = 'flex';
            card.style.gridTemplateColumns = 'none';
        });
    }
}

// Animation au scroll
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.quiz-card');
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    });
    
    cards.forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'all 0.5s ease';
        observer.observe(card);
    });
});

// Auto-submit du formulaire lors du changement de tri
document.querySelector('.sort-select').addEventListener('change', function() {
    const form = document.querySelector('.search-form');
    const hiddenInput = document.createElement('input');
    hiddenInput.type = 'hidden';
    hiddenInput.name = 'sort';
    hiddenInput.value = this.value;
    form.appendChild(hiddenInput);
    form.submit();
});
</script>
{% endblock %}
